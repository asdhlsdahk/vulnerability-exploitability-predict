import pandas as pd
import csv
import os
idx = 0
y = []
dirpath = "E:\大学学习\研究生\毕设\\data\\user"
for filename in os.listdir(dirpath):
    dirna1 = dirpath + "\\" + filename
    csvnameread = dirna1 + "\\1.csv"
    csvnamewrite = dirna1 + "\\bertall\\trainbertallw.csv"
    data = pd.read_csv(csvnameread)
    csvFile = open(csvnamewrite, 'a', newline='', encoding='utf-8')
    writer = csv.writer(csvFile)
    writer.writerow(('cve-id','vector',
                     'EXP'))
    for j in range(0, len(data['vector'])):
        fast = []
        fa = data["vector"][j]
        fa1 = fa.split(" ")
        fa2 = [float(y) for y in fa1]
        fast = fa2[:236]

        # print(fast)
        try:
            cveid = data["cve-id"][j]
            exp = data['EXP'][j]

            csvnamebert = "E:\大学学习\研究生\毕设\\BERT\\afterbert128\\" + cveid + ".csv"
            data1 = pd.read_csv(csvnamebert)
            vec = data1["vec"][0]

            vectorlist = vec[1:-1].split(", ")

            vector = [float(x) for x in vectorlist]
            fast.extend(vector)
            # fast.insert(0, exp)
            # print(len(fast))
            writetxt = ''
            for h in range(0, len(fast)):
                writetxt = writetxt + str(fast[h]) + " "
            writetxt = writetxt[:-1]
            # print(writetxt)

            # print(fast)
            # print(len(fast))
            writer.writerow((cveid, writetxt, exp))
        except:
            print(cveid)



# ------------不全换成float-----------------
# for i in range(0,337):
#     if i <236:
#         b[i] = int(b[i])
#     if i >= 236 and i <= 300:
#         b[i] = float(b[i])
#     if i>300 and i <335:
#         b[i] = int(b[i])
#     if i>=335:
#         b[i] = float(b[i])
# -----------------------------------------
# 236-300 335-337